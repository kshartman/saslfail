# /etc/fail2ban/jail.d/dovecot-escalating.conf
# Progressive ban system: 48h -> 8 days -> 32 days
# Escalation handled by ban-tracker.sh

# First Strike: 48 hours (watches auth.log for dovecot failures)
[dovecot-first]
enabled = true
port = pop3,pop3s,imap,imaps,submission,465,sieve
logpath = /var/log/auth.log
backend = auto
maxretry = 2
findtime = 86400
bantime = 172800
filter = dovecot[mode=aggressive]
action = iptables-multiport[name=dovecot-1st, port="110,995,143,993,587,465,4190", protocol=tcp]
         ban-tracker[name=dovecot-first, email=none]
ignoreip = 127.0.0.1/8 ::1 192.168.0.0/16 10.0.0.0/8 172.16.0.0/12

# Second Strike: 8 days (NO FILTER - populated by ban-tracker.sh)
[dovecot-second]
enabled = true
port = pop3,pop3s,imap,imaps,submission,465,sieve
logpath = /var/log/fail2ban.log
backend = auto
maxretry = 999999
findtime = 1
bantime = 691200
filter = postfix-sasl-dummy
action = iptables-multiport[name=dovecot-2nd, port="110,995,143,993,587,465,4190", protocol=tcp]
ignoreip = 127.0.0.1/8 ::1 192.168.0.0/16 10.0.0.0/8 172.16.0.0/12

# Third Strike: 32 days (NO FILTER - populated by ban-tracker.sh)
[dovecot-third]
enabled = true
port = pop3,pop3s,imap,imaps,submission,465,sieve
logpath = /var/log/fail2ban.log
backend = auto
maxretry = 999999
findtime = 1
bantime = 2764800
filter = postfix-sasl-dummy
action = iptables-multiport[name=dovecot-3rd, port="110,995,143,993,587,465,4190", protocol=tcp]
ignoreip = 127.0.0.1/8 ::1 192.168.0.0/16 10.0.0.0/8 172.16.0.0/12

# /etc/fail2ban/jail.d/postfix-sasl-escalating.conf
# Progressive ban system v2: 48h -> 8 days -> 32 days
# Escalation handled by ban-tracker.sh (not recidive filters)

# First Strike: 48 hours (watches mail.log for SASL failures)
[postfix-sasl-first]
enabled = true
port = smtp,465,587,submission,smtps
logpath = /var/log/mail.log
          /var/log/postfix.log
          /var/log/maillog
backend = auto
maxretry = 1
findtime = 86400
bantime = 172800
filter = postfix-sasl-strict
action = iptables-multiport[name=postfix-sasl-1st, port="25,465,587", protocol=tcp]
         ban-tracker[name=postfix-sasl-first, email=%(ban_notification_email)s]
%(optional_immediate_email)s
ignoreip = 127.0.0.1/8 ::1 192.168.0.0/16 10.0.0.0/8 172.16.0.0/12

# Second Strike: 8 days (NO FILTER - populated by ban-tracker.sh)
[postfix-sasl-second]
enabled = true
port = smtp,465,587,submission,smtps
logpath = /var/log/fail2ban.log
backend = auto
maxretry = 999999
findtime = 1
bantime = 691200
filter = postfix-sasl-dummy
action = iptables-multiport[name=postfix-sasl-2nd, port="25,465,587", protocol=tcp]
ignoreip = 127.0.0.1/8 ::1 192.168.0.0/16 10.0.0.0/8 172.16.0.0/12

# Third Strike: 32 days (NO FILTER - populated by ban-tracker.sh)
[postfix-sasl-third]
enabled = true
port = smtp,465,587,submission,smtps
logpath = /var/log/fail2ban.log
backend = auto
maxretry = 999999
findtime = 1
bantime = 2764800
filter = postfix-sasl-dummy
action = iptables-multiport[name=postfix-sasl-3rd, port="25,465,587", protocol=tcp]
ignoreip = 127.0.0.1/8 ::1 192.168.0.0/16 10.0.0.0/8 172.16.0.0/12